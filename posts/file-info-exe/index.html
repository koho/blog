<!doctype html><html lang=zh-cn id=page><head><meta charset=utf-8><title>给 exe 添加文件信息 - X̂ Blog</title><meta name=viewport content="width=device-width,initial-scale=1"><link href=/css/font.css type=text/css rel=stylesheet><link href=/css/main.css type=text/css rel=stylesheet><link href=/css/github-markdown-light.css type=text/css rel=stylesheet><link rel=icon href=/favicon.svg></head><body><header><a href=/ id=logo><svg xmlns="http://www.w3.org/2000/svg" width="38.82" height="52.68" viewBox="0 -765 572 776" xmlns:xlink="http://www.w3.org/1999/xlink"><defs><path id="MJX-9-TEX-I-78" d="M52 289q7 42 54 97t116 56q35 0 64-18t43-45q42 63 101 63 37 0 64-22t28-59q0-29-14-47t-27-22-23-4q-19 0-31 11t-12 29q0 46 50 63-11 13-40 13-13 0-19-2-38-16-56-66-60-221-60-258 0-28 16-40t35-12q37 0 73 33t49 81q3 10 6 11t16 2h4q15 0 15-8 0-1-2-11-16-57-62-101T333-11q-70 0-106 63-41-62-94-62h-6Q78-10 57 16T35 71q0 32 19 52t45 20q43 0 43-42 0-20-12-35T107 46 94 41l-3-1q0-1 6-4t16-7 19-3q36 0 62 45 9 16 23 68t28 108 16 66q5 27 5 39 0 28-15 40t-34 12q-40 0-75-32T93 290q-2-9-5-10t-16-2H58q-6 6-6 11z"/><path id="MJX-9-TEX-N-5E" d="M112 560 249 694l8-8Q387 562 387 560l-26-29q-2 1-58 50l-53 46-55-47q-13-11-26-23t-21-19l-8-6q-2-2-15 14l-13 14z"/></defs><g stroke="currentcolor" fill="currentcolor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><g data-mml-node="math"><g data-mml-node="TeXAtom"><g data-mml-node="mover"><g data-mml-node="mi"><use xlink:href="#MJX-9-TEX-I-78"/></g><g data-mml-node="mo" transform="translate(63.8, -29)"><use xlink:href="#MJX-9-TEX-N-5E"/></g></g></g></g></g></svg><b>xhat</b></a><nav><ul><li><a href=/ class=active>文章</a></li><li><a href=/tags/>标签</a></li><li><a href=/archives/>归档</a></li><li><a href=/about/>关于</a></li></ul></nav></header><section class=main><article class=content><h2 class=title>给 exe 添加文件信息</h2><div class=remark><time datetime="2022-02-08 15:36:31 +0800 +0800">2022-02-08</time></div><div class=tags><a href=/tags/windows/>Windows</a></div><div class=markdown-body><h2 id=创建清单文件>创建清单文件</h2><p>文件名为<code>manifest.xml</code>。如果不需要管理器权限，就把<code>trustInfo</code>删掉。</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#999;font-weight:700;font-style:italic>&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34; standalone=&#34;yes&#34;?&gt;</span>
</span></span><span style=display:flex><span><span style=color:navy>&lt;assembly</span> <span style=color:teal>xmlns=</span><span style=color:#d14>&#34;urn:schemas-microsoft-com:asm.v1&#34;</span> <span style=color:teal>manifestVersion=</span><span style=color:#d14>&#34;1.0&#34;</span><span style=color:navy>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:navy>&lt;assemblyIdentity</span> <span style=color:teal>version=</span><span style=color:#d14>&#34;1.0.0.0&#34;</span> <span style=color:teal>processorArchitecture=</span><span style=color:#d14>&#34;*&#34;</span> <span style=color:teal>name=</span><span style=color:#d14>&#34;app&#34;</span> <span style=color:teal>type=</span><span style=color:#d14>&#34;win32&#34;</span><span style=color:navy>/&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:navy>&lt;trustInfo</span> <span style=color:teal>xmlns=</span><span style=color:#d14>&#34;urn:schemas-microsoft-com:asm.v2&#34;</span><span style=color:navy>&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:navy>&lt;security&gt;</span>
</span></span><span style=display:flex><span>          <span style=color:navy>&lt;requestedPrivileges</span> <span style=color:teal>xmlns=</span><span style=color:#d14>&#34;urn:schemas-microsoft-com:asm.v3&#34;</span><span style=color:navy>&gt;</span>
</span></span><span style=display:flex><span>            <span style=color:navy>&lt;requestedExecutionLevel</span> <span style=color:teal>level=</span><span style=color:#d14>&#34;requireAdministrator&#34;</span> <span style=color:teal>uiAccess=</span><span style=color:#d14>&#34;false&#34;</span> <span style=color:navy>/&gt;</span>
</span></span><span style=display:flex><span>          <span style=color:navy>&lt;/requestedPrivileges&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:navy>&lt;/security&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:navy>&lt;/trustInfo&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:navy>&lt;dependency&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:navy>&lt;dependentAssembly&gt;</span>
</span></span><span style=display:flex><span>            <span style=color:navy>&lt;assemblyIdentity</span> <span style=color:teal>type=</span><span style=color:#d14>&#34;win32&#34;</span> <span style=color:teal>name=</span><span style=color:#d14>&#34;Microsoft.Windows.Common-Controls&#34;</span> <span style=color:teal>version=</span><span style=color:#d14>&#34;6.0.0.0&#34;</span> <span style=color:teal>processorArchitecture=</span><span style=color:#d14>&#34;*&#34;</span> <span style=color:teal>publicKeyToken=</span><span style=color:#d14>&#34;6595b64144ccf1df&#34;</span> <span style=color:teal>language=</span><span style=color:#d14>&#34;*&#34;</span><span style=color:navy>/&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:navy>&lt;/dependentAssembly&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:navy>&lt;/dependency&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:navy>&lt;application</span> <span style=color:teal>xmlns=</span><span style=color:#d14>&#34;urn:schemas-microsoft-com:asm.v3&#34;</span><span style=color:navy>&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:navy>&lt;windowsSettings&gt;</span>
</span></span><span style=display:flex><span>            <span style=color:navy>&lt;dpiAwareness</span> <span style=color:teal>xmlns=</span><span style=color:#d14>&#34;http://schemas.microsoft.com/SMI/2016/WindowsSettings&#34;</span><span style=color:navy>&gt;</span>PerMonitorV2, PerMonitor<span style=color:navy>&lt;/dpiAwareness&gt;</span>
</span></span><span style=display:flex><span>            <span style=color:navy>&lt;dpiAware</span> <span style=color:teal>xmlns=</span><span style=color:#d14>&#34;http://schemas.microsoft.com/SMI/2005/WindowsSettings&#34;</span><span style=color:navy>&gt;</span>True<span style=color:navy>&lt;/dpiAware&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:navy>&lt;/windowsSettings&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:navy>&lt;/application&gt;</span>
</span></span><span style=display:flex><span><span style=color:navy>&lt;/assembly&gt;</span>
</span></span></code></pre></div><h2 id=创建资源文件>创建资源文件</h2><p>文件名为<code>resources.rc</code>，如果没有清单文件，可将对应的行删掉，图标文件类似。</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span><span style=color:#999;font-weight:700;font-style:italic>#include</span> <span style=color:#999;font-weight:700;font-style:italic>&lt;windows.h&gt;</span><span style=color:#999;font-weight:700;font-style:italic>
</span></span></span><span style=display:flex><span><span style=color:#999;font-weight:700;font-style:italic></span>
</span></span><span style=display:flex><span><span style=color:#999;font-weight:700;font-style:italic>#pragma code_page(65001) </span><span style=color:#998;font-style:italic>// UTF-8
</span></span></span><span style=display:flex><span><span style=color:#998;font-style:italic></span>
</span></span><span style=display:flex><span><span style=color:#999;font-weight:700;font-style:italic>#define STRINGIZE(x) #x
</span></span></span><span style=display:flex><span><span style=color:#999;font-weight:700;font-style:italic>#define EXPAND(x) STRINGIZE(x)
</span></span></span><span style=display:flex><span><span style=color:#999;font-weight:700;font-style:italic></span>
</span></span><span style=display:flex><span>LANGUAGE LANG_NEUTRAL, SUBLANG_NEUTRAL
</span></span><span style=display:flex><span>CREATEPROCESS_MANIFEST_RESOURCE_ID RT_MANIFEST manifest.xml
</span></span><span style=display:flex><span><span style=color:#099>10</span>        ICON           <span style=color:#900;font-weight:700>EXPAND</span>(APP_ICO)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>VS_VERSION_INFO VERSIONINFO
</span></span><span style=display:flex><span>FILEVERSION    VERSION_ARRAY
</span></span><span style=display:flex><span>PRODUCTVERSION VERSION_ARRAY
</span></span><span style=display:flex><span>FILEFLAGSMASK  VS_FFI_FILEFLAGSMASK
</span></span><span style=display:flex><span>FILEFLAGS      <span style=color:#099>0x0</span>
</span></span><span style=display:flex><span>FILEOS         VOS__WINDOWS32
</span></span><span style=display:flex><span>FILETYPE       VFT_APP
</span></span><span style=display:flex><span>FILESUBTYPE    VFT2_UNKNOWN
</span></span><span style=display:flex><span>BEGIN
</span></span><span style=display:flex><span>  BLOCK <span style=color:#d14>&#34;StringFileInfo&#34;</span>
</span></span><span style=display:flex><span>  BEGIN
</span></span><span style=display:flex><span>    BLOCK <span style=color:#d14>&#34;080404B0&#34;</span>
</span></span><span style=display:flex><span>    BEGIN
</span></span><span style=display:flex><span>      VALUE <span style=color:#d14>&#34;CompanyName&#34;</span>, <span style=color:#d14>&#34;Your Company&#34;</span>
</span></span><span style=display:flex><span>      VALUE <span style=color:#d14>&#34;FileDescription&#34;</span>, <span style=color:#d14>&#34;Example&#34;</span>
</span></span><span style=display:flex><span>      VALUE <span style=color:#d14>&#34;FileVersion&#34;</span>, <span style=color:#900;font-weight:700>EXPAND</span>(VERSION_STR)
</span></span><span style=display:flex><span>      VALUE <span style=color:#d14>&#34;InternalName&#34;</span>, <span style=color:#d14>&#34;Example&#34;</span>
</span></span><span style=display:flex><span>      VALUE <span style=color:#d14>&#34;LegalCopyright&#34;</span>, <span style=color:#d14>&#34;© example&#34;</span>
</span></span><span style=display:flex><span>      VALUE <span style=color:#d14>&#34;OriginalFilename&#34;</span>, <span style=color:#d14>&#34;example.exe&#34;</span>
</span></span><span style=display:flex><span>      VALUE <span style=color:#d14>&#34;ProductName&#34;</span>, <span style=color:#d14>&#34;EXAMPLE&#34;</span>
</span></span><span style=display:flex><span>      VALUE <span style=color:#d14>&#34;ProductVersion&#34;</span>, <span style=color:#900;font-weight:700>EXPAND</span>(PRODUCT_VERSION_STR)
</span></span><span style=display:flex><span>      VALUE <span style=color:#d14>&#34;Comments&#34;</span>, <span style=color:#d14>&#34;https://example.com&#34;</span>
</span></span><span style=display:flex><span>    END
</span></span><span style=display:flex><span>  END
</span></span><span style=display:flex><span>  BLOCK <span style=color:#d14>&#34;VarFileInfo&#34;</span>
</span></span><span style=display:flex><span>  BEGIN
</span></span><span style=display:flex><span>    VALUE <span style=color:#d14>&#34;Translation&#34;</span>, <span style=color:#099>0x0804</span>, <span style=color:#099>1200</span>
</span></span><span style=display:flex><span>  END
</span></span><span style=display:flex><span>END
</span></span></code></pre></div><h2 id=编译资源>编译资源</h2><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>windres -DVERSION_ARRAY<span style=color:#000;font-weight:700>=</span>1,0,1,0 -DVERSION_STR<span style=color:#000;font-weight:700>=</span>1.0.1.0 -DPRODUCT_VERSION_STR<span style=color:#000;font-weight:700>=</span>1.0.1.0 -DAPP_ICO<span style=color:#000;font-weight:700>=</span>app.ico -i resources.rc -o rsrc.o -O coff -c <span style=color:#099>65001</span>
</span></span></code></pre></div><h2 id=参考>参考</h2><p>[1] <a href=https://docs.microsoft.com/en-us/windows/win32/menurc/versioninfo-resource>VERSIONINFO Resource</a></p></div><link href=https://cdn.bootcdn.net/ajax/libs/KaTeX/0.12.0/katex.min.css rel=stylesheet><script src=https://cdn.bootcdn.net/ajax/libs/KaTeX/0.12.0/katex.min.js></script>
<script src=https://cdn.bootcdn.net/ajax/libs/KaTeX/0.12.0/contrib/auto-render.min.js onload='renderMathInElement(document.querySelector(`.content`),{delimiters:[{left:"$$",right:"$$",display:!0},{left:"$",right:"$",display:!1}]})'></script></article></section><section class=tail><div class=content id=post-nav><a title="Git 备忘" rel=prev href=/posts/git-remind/><span>前篇</span>Git 备忘</a>
<a title="使用 MQTT 实现 API 接口" rel=next href=/posts/mqtt-create-api/><span>后篇</span>使用 MQTT 实现 API 接口</a></div><div class=content id=post-comment><script src=https://giscus.app/client.js data-repo=koho/blog data-repo-id="MDEwOlJlcG9zaXRvcnkzMjM1MDUxMDk=" data-category=Announcements data-category-id=DIC_kwDOE0hL1c4COeTz data-mapping=pathname data-reactions-enabled=1 data-emit-metadata=0 data-input-position=bottom data-theme=light data-lang=zh-CN crossorigin=anonymous async></script></div><div class=content id=post-related><h3 class=title>延伸阅读</h3><div class=grid><div class=card><a href=/posts/golang-windows-service/ rel=bookmark><div class=banner style=background-image:url(/images/windowsservices-serviceswindow.png)></div><h4>Golang 程序以 Windows 服务运行</h4><p>2021-11-12</p><div class=tags><span>Golang</span>
<span>Windows</span></div></a></div><div class=card><a href=/posts/golang-gui-singleton/ rel=bookmark><div class=banner style=background-image:url(/images/multiple-instance-image.jpg)></div><h4>Golang 在 Windows 下防止程序多开</h4><p>2021-10-11</p><div class=tags><span>Golang</span>
<span>Windows</span></div></a></div></div></div></section><footer><span>Powered by <a href=https://gohugo.io>Hugo</a></span><br><span>© 2022 xhat</span></footer></body></html>